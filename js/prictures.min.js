(function(e){function u(){this.images=new Array;this.setTitle=function(e){if(e!=null){this.title=e}else{this.title="Image Gallery"}};this.setImageDir=function(e){if(e!=null){this.imageDir=e}else{this.imageDir="."}};this.setThumbDir=function(e){if(e!=null){this.thumbDir=e}else{this.thumbDir="."}};this.setThumbPrefix=function(e){if(e!=null){this.thumbPrefix=e}else{this.thumbPrefix=""}};this.getThumbPrefix=function(){return this.thumbPrefix};this.addImage=function(e,t){var n=new Image;n.src=this.getImageDir()+"/"+e;var r=new Image;r.src=this.getThumbDir()+"/"+this.getThumbPrefix()+e;var i={};if(t!=null){n.setAttribute("title",t);n.setAttribute("alt",t);r.setAttribute("alt",t);i.description=t}i.image=n;i.thumb=r;this.images.push(i)};this.setPageSize=function(e){this.pageSize=e};this.getImage=function(e){return this.images[e].image};this.getThumb=function(e){return this.images[e].thumb};this.getImgDsc=function(e){return this.images[e].description};this.getPageSize=function(){return this.pageSize};this.getImageDir=function(){return this.imageDir};this.getThumbDir=function(){return this.thumbDir};this.getLength=function(){return this.images.length}}var t=0;var n;var r={xmlFile:"images.xml",startImg:0};var i={};var s={init:function(t){i=e.extend({},r,t);return this.each(function(){var t=e(this),n=this;e(this).prictures("showDOM");o.loadXML()})},showDOM:function(){e(this).append(o.buildDOM())},showImage:function(t){e("#image img").remove();e("#caption").remove();e("#image").append(o.buildImage(t));e("#image").append(o.buildCaption(t));var r=parseInt(t),i=parseInt(t);var s=n.getLength();if(r<s-1){r++}else{r=0}e("#next").attr("onclick","$(this).prictures('showImage',"+r+")");if(i>0){i--}else{i=s-1}e("#back").attr("onclick","$(this).prictures('showImage',"+i+")")},prevPage:function(){var r=parseInt(n.getPageSize());var i=parseInt(n.getLength());t-=r;if(t<0){if(i%r==0){t=i-r}else{t=i-i%r}}e(this).prictures("showGallery")},nextPage:function(){var r=n.getPageSize();t+=parseInt(r);if(t>=n.getLength()){t=0}e(this).prictures("showGallery")},showGallery:function(){e("#imageList").empty();if(n.getPageSize()!=null){e("#imageList").append(o.buildNav())}e("#imageList").append(o.buildGallery(t))},showTitle:function(){e("#title").empty();e("#title").append(o.buildTitle())},hideGallery:function(){e("#imageList").toggle();e("#image").toggle()}};var o={buildCaption:function(e){var t=n.getImgDsc(e);if(t!=null){console.log(t);var r=document.createTextNode(t);var i=document.createElement("p");i.setAttribute("id","caption");i.appendChild(r);return i}},loadXML:function(){e.ajax({type:"GET",url:i["xmlFile"],dataType:"xml",success:function(t){e(t).find("gallery").each(function(){n=o.loadGallery(e(this))});e(this).prictures("showTitle");e(this).prictures("showGallery");e(this).prictures("showImage",i["startImg"])}})},buildImage:function(e){var t=n.getImage(e);o.setSize(t);return t},buildGallery:function(e){var t=n.getLength();var r=n.getPageSize();var i=document.createElement("ul");for(index=e;index<t;index++){var s=document.createElement("li");var o=n.getThumb(index);o.setAttribute("onclick","$(this).prictures('showImage',"+index+")");s.appendChild(o);i.appendChild(s);if((index+1)%r==0){break}}return i},loadGallery:function(t){var n=new u;n.setTitle(t.attr("name"));n.setImageDir(t.attr("images"));n.setThumbDir(t.attr("thumbs"));n.setPageSize(t.attr("count"));n.setThumbPrefix(t.attr("prefix"));t.find("image").each(function(){n.addImage(e(this).text(),e(this).attr("desc"))});return n},buildDOM:function(){var e=document.createElement("div");div=document.createElement("div");div.setAttribute("id","title");div.setAttribute("onclick","$(this).prictures('hideGallery');");e.appendChild(div);div=document.createElement("div");div.setAttribute("id","imageList");e.appendChild(div);div=document.createElement("div");div.setAttribute("id","image");var t=document.createElement("p");t.setAttribute("id","back");tn=document.createTextNode("<");t.appendChild(tn);div.appendChild(t);t=document.createElement("p");t.setAttribute("id","next");tn=document.createTextNode(">");t.appendChild(tn);div.appendChild(t);e.appendChild(div);e.setAttribute("id","prictures");return e},buildTitle:function(){var e=n.title;var t=document.createElement("h1");var r=document.createTextNode(e);t.appendChild(r);return t},setSize:function(t){var n=t;var r=n.height;var i=n.width;if(i>r){var s=Math.floor(e("#prictures").width()*.5)/i;var o=Math.floor(s*i);o=o*1;var u=Math.floor(s*r);u=u*1;n.setAttribute("width",o);n.setAttribute("height",u);console.log(e("#prictures").width())}else{var s=Math.floor(e("#prictures").height()-100)/r;var o=Math.floor(s*i);o=o*1;var u=Math.floor(s*r);u=u*1;n.setAttribute("width",o);n.setAttribute("height",u);console.log(e("#prictures").width())}},buildNav:function(){var e=document.createElement("p");var t=document.createElement("span");t.setAttribute("class","link");var n=document.createElement("span");n.setAttribute("class","link");backText=document.createTextNode("Back");t.appendChild(backText);nextText=document.createTextNode("Next");n.appendChild(nextText);t.setAttribute("onclick","$(this).prictures('prevPage')");n.setAttribute("onclick","$(this).prictures('nextPage')");e.appendChild(t);e.appendChild(n);return e}};e.fn.prictures=function(t){if(s[t]){return s[t].apply(this,Array.prototype.slice.call(arguments,1))}else if(typeof t==="object"||!t){return s.init.apply(this,arguments)}else{e.error("Method "+t+" does not exist on jQuery.prictures")}}})(jQuery)
